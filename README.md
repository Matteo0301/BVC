# BVC Market

Here we will store the library files of our Market.

## Market Strategy

### Notation:

- `buy price` := the price of the goods offered to the trader.
- `sell price` := the price of the goods that the market is willing to pay to the trader.
- `price` := exchange rate.

## Initial goods allocation:

- `eur` := random percentage in range `(25%,35%)` of `STARTING_CAPITAL`.
- `second_good` := random percentage in range `(30%,36%)` of `(STARTING_CAPITAL - eur)`.
- `third_good` := random percentage in range `(45%,55%)` of `(STARTING_CAPITAL - eur - to_eur(second_good) )`.
- `fourth_good` := the remaining capital.

> In the initialization, good order is randomized.

## Price fluctuation:

> **Premise**: `eur` always has a 1:1 conversion rate



The following rules are applied:  

- The market refuses **any** `lock buy` that would leave it with less than `25%` of the initial quantity of the asked good.

- The market refuses **any** `lock sell` that would leave it with less than `25%` of the initial `eur` quantity.

- Define a value `mean` := for each good that is not EUR, convert it to EUR ( using default exchange rates ), sum them all together, then divide the obtained value by 3 ( which is the number of goods except EUR).  

$$mean = \frac{\sum_{i=0}^{2}toeur(goods_i)}{3}$$
<br>

- If a good has its quantity below the `mean` , (buy) price will fluctuate incrementally using this formula:

$$ price = \left(\left(\frac{mean-goodqty}{mean\cdot 0.75}\cdot 0.1\right)+1\right)\cdot defaultprice$$
<br>

> This means that if a good it's at its minimum quantity, the trader will pay it 10% more than the default exchange rate.

- If a good has its quantity between `(0%,5%)` over the `mean`, then the default price of that good will be used.

- If a good overcomes the mean by a percentage in range `(5%,10%)`, a favorable price will be applied, hence it will deflate by `2%` from the default price.

- If a good overcomes the mean by a percentage in range `(10%,30%)`, a favorable price will be applied, hence it will deflate by `2.5%` from the default price.

- If a good overcomes the mean by a percentage in range `(30%,60%)`, a favorable price will be applied, hence it will deflate by `3%` from the default price.

- If a good overcomes the mean by more than `60%`, a favorable price will be applied, hence it will deflate by `3.5%` from the default price.

- The `sell price` is always lower than the `buy price`, by exactly `1%`

- If the trader wants to buy a quantity in range `(30%,50%)` of a certain good, the market will apply a `2%` discount on the `buy price` indiscriminately.
  
- If the trader wants to buy more than `50%` of a certain good, the market will apply a `3.5%` discount on the `buy price` indiscriminately.

## Good conversion:

The logic is trying to equalize good quantities, but not always, to avoid conflicts with the discount logic applyed in the price fluctuation

- If i have less than 30% of the initial quantity of a given good, it is `suffering`. To refill it, the market will take a good such that: 

    $$chosengood = \max(toeur(good)) \ \forall good : (toeur(good) > eurgoodquantity \wedge isnotmarkedasexported(good))$$
    <br>

    Then mark it as an exporter and with a `50%` probability take a part of it which is:

    $$convertedpart = \min(10000,0.5*(toeur(chosengood)-eurquantity))$$
    <br>

    and then sum it to the `suffering` good.

  - If the suffering good is `eur`, then the probability of conversion drops to 30% instead of being 50%


## Event reaction

To keep the market strategy safer and stable we decided to avoid reacting to external events generated by other markets.